<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>tobeMaker-idea</title>
    <?php include "top_css.php" ?>
</head>
<body>
<div id="top">
    <?php include "header.php" ?>
</div>
<div id="center">
    <div class="middle-margin">
        <div class="slogan">
            大家的想法都在这里，喜欢的话不妨点赞支持一下吧！
        </div>
        <div id="idea-list-block" class="content list">
            <div id="idea-list-content">
                <dl>
                    <dd><a href="item.html"><img src="asset/13.png" alt=""></a></dd>
                    <dt>云品良木@韩版 简约风 卡通动物 大容量 铁皮盒 学生文具盒 12款</dt>
                    <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>
                    <dd>
                        <a href="#" class="avatar"><img src="asset/12.png" alt=""></a>
                        <a href="#" class="author">糯米团子</a>
                        <span>发布</span>
                    </dd>
                    <dd>
                        <div class="button"><a href="#">分享</a></div>
                        <div class="button"><a href="#">评论</a><span>23</span></div>
                        <div class="button"><a href="#">超喜欢</a><span>23</span></div>
                    </dd>

                </dl>
                <dl>
                    <dd><a href="item.html"><img src="asset/13.png" alt=""></a></dd>
                    <dt>云品良木@韩版 简约风 卡通动物 大容量 铁皮盒 学生文具盒 12款</dt>
                    <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>
                    <dd>
                        <a href="#" class="avatar"><img src="asset/12.png" alt=""></a>
                        <a href="#" class="author">糯米团子</a>
                        <span>发布</span>
                    </dd>
                    <dd>
                        <div class="button"><a href="#">分享</a></div>
                        <div class="button"><a href="#">评论</a><span>23</span></div>
                        <div class="button"><a href="#">超喜欢</a><span>23</span></div>
                    </dd>

                </dl>
                <dl>
                    <dd><a href="item.html"><img src="asset/13.png" alt=""></a></dd>
                    <dt>云品良木@韩版 简约风 卡通动物 大容量 铁皮盒 学生文具盒 12款</dt>
                    <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>
                    <dd>
                        <a href="#" class="avatar"><img src="asset/12.png" alt=""></a>
                        <a href="#" class="author">糯米团子</a>
                        <span>发布</span>
                    </dd>
                    <dd>
                        <div class="button"><a href="#">分享</a></div>
                        <div class="button"><a href="#">评论</a><span>23</span></div>
                        <div class="button"><a href="#">超喜欢</a><span>23</span></div>
                    </dd>

                </dl>
                <dl>
                    <dd><a href="item.html"><img src="asset/13.png" alt=""></a></dd>
                    <dt>云品良木@韩版 简约风 卡通动物 大容量 铁皮盒 学生文具盒 12款</dt>
                    <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>
                    <dd>
                        <a href="#" class="avatar"><img src="asset/12.png" alt=""></a>
                        <a href="#" class="author">糯米团子</a>
                        <span>发布</span>
                    </dd>
                    <dd>
                        <div class="button"><a href="#">分享</a></div>
                        <div class="button"><a href="#">评论</a><span>23</span></div>
                        <div class="button"><a href="#">超喜欢</a><span>23</span></div>
                    </dd>

                </dl>
                <dl>
                    <dd><a href="item.html"><img src="asset/13.png" alt=""></a></dd>
                    <dt>云品良木@韩版 简约风 卡通动物 大容量 铁皮盒 学生文具盒 12款</dt>
                    <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>
                    <dd>
                        <a href="#" class="avatar"><img src="asset/12.png" alt=""></a>
                        <a href="#" class="author">糯米团子</a>
                        <span>发布</span>
                    </dd>
                    <dd>
                        <div class="button"><a href="#">分享</a></div>
                        <div class="button"><a href="#">评论</a><span>23</span></div>
                        <div class="button"><a href="#">超喜欢</a><span>23</span></div>
                    </dd>

                </dl>
                <dl>
                    <dd><a href="item.html"><img src="asset/13.png" alt=""></a></dd>
                    <dt>云品良木@韩版 简约风 卡通动物 大容量 铁皮盒 学生文具盒 12款</dt>
                    <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>
                    <dd>
                        <a href="#" class="avatar"><img src="asset/12.png" alt=""></a>
                        <a href="#" class="author">糯米团子</a>
                        <span>发布</span>
                    </dd>
                    <dd>
                        <div class="button"><a href="#">分享</a></div>
                        <div class="button"><a href="#">评论</a><span>23</span></div>
                        <div class="button"><a href="#">超喜欢</a><span>23</span></div>
                    </dd>

                </dl>
            </div>

            <div class="prev">
                <div><a href="javascript:0"><</a></div>
            </div>
            <div class="next">
                <div><a href="javascript:0">></a></div>
            </div>

            <br class="clear"/>

        </div>
        <div id="project-pagenum" class="pagenum" data-url="<?=BASE_URL."api/project_list.php"?>">
            <a href="#">1</a>
            <a href="#">2</a>
            <a href="#">3</a>
            <a href="#">4</a>
            <a href="#">5</a>
            <a href="#">6</a>
            <a href="#">7</a>
            <a href="#">8</a>
            <a href="#">9</a>

        </div>

    </div>

</div>

<div id="footer">
    <?php include "footer.php" ?>
</div>

<?php include "bottom_js.php" ?>

<!--换页按钮定位相关js-->
<!--需要jQuery-->
<!--监听浏览器长宽改变-->

<script type="text/javascript" charset="utf-8">
    function a(){
            $(".prev").height( $(window).height() );
            $(".prev").css("line-height" , $(window).height()+"px");
            $(".prev").css("left" , ($(window).width() - 1020)/2 - 70 +"px");
            $(".next").height( $(window).height() );
            $(".next").css("line-height" , $(window).height()+"px");
            $(".next").css("left" , ($(window).width() - 1020)/2 + 1040 +"px");
    }
    
    var pageSize = 6;
    var pageNow = 1;
    var maxPageNo = 1;
    
    function loadIdeaPage(current_page){
        
        var start = (current_page - 1) * pageSize;
        var length = pageSize;
        var url = $('#project-pagenum').data("url");
        $.post(url, {"start":start, "length":length, "type":"pass", "user_id":<?=$current_user['user_id']?>}, function(data, textStatus){
            console.log(data);
            
            // set up content
            var $container = $('#idea-list-content');
            $container.html('');
            
            for (var i=0; data.data != undefined && i<data.data.length; i++){
                var item = data.data[i];

                $container.append('\
            <dl>\
                <dd><a href="project.php?idea_id='+ item.idea_id +'"><img src="'+(item['picture_url']==undefined?'asset/13.png':item['picture_url'])+'" alt=""></a></dd>\
                <dt>'+ item.name +'</dt>\
                <dd><div class="bar"><div class="done" style="width: 60%"></div></div></dd>\
                <dd>\
                    <a href="#" class="avatar"><img class="circle" src="'+(item['head_pic_url']==undefined?'asset/15.png':item['head_pic_url'])+'" alt=""></a>\
                    <a href="<?=BASE_URL?>person.php?user_id='+item.user_id+'" class="author">'+ item.user_name +'</a>\
                    <span>发布</span>\
                </dd>\
                <dd>\
                    <div class="button"><a href="#">分享</a></div>\
                    <div class="button"><a href="project.php?idea_id='+ item.idea_id +'#commentForm">评论</a><span>'+ (item.sum_comment == null ? 0 : item.sum_comment) +'</span></div>\
                    <div class="button"><a class="like_btn '+ (item.likeit == 0 ? '':'red') +'" href="javascript:void 0" data-idea_id="'+ item.idea_id +'" data-url="<?=BASE_URL."api/like.php"?>" >超喜欢</a><span>'+ (item.sum_like == null ? 0 : item.sum_like) +'</span></div>\
                </dd>\
            </dl>');
            }
            
            // set up page nav
            var $pageNav = $('#project-pagenum');
            $pageNav.html('');
            maxPageNo = Math.ceil( parseInt(data.num_of_all) / pageSize );
            for (var i=1; i<=maxPageNo && i<=9; i++){
                var pageNavClass = "";
                if (i == current_page){
                    pageNavClass = ' class="active" ';
                }
                $pageNav.append('<a href="#" '+ pageNavClass +' >'+ i +'</a>');
            }
            if (maxPageNo > 9){
                $pageNav.append('<a>...</a>');
            }
        },"json");
    }
    
    $("#project-pagenum").on("click","a",function(){
        var current_page = parseInt( $(this).text() );
        pageNow = current_page;
        loadIdeaPage(pageNow);
    });
    
    $(document).ready(function(){
        window.onresize= a;
        a();
        pageNow = 1;
        loadIdeaPage(pageNow);
        
        $('#idea-list-block .next').click(function(){
            if (pageNow < maxPageNo){
                pageNow++;
                loadIdeaPage(pageNow);
            }
        });
        
        $('#idea-list-block .prev').click(function(){
            if (pageNow > 1){
                pageNow--;
                loadIdeaPage(pageNow);
            }
        });
        
        $("#idea-list-content").on('click', ".like_btn", function(){
            var the_like_btn = $(this);
            var url = $(this).data("url");
            var idea_id = $(this).data("idea_id");
            
            //TODO:从当前登录用户信息中获取用户id
            var user_id = <?=$current_user['user_id']?>;
            $.post(url, {'idea_id':idea_id, 'user_id':user_id}, function(data,textStatus){
                var status = data['status'];
                if (status == "success"){
                    the_like_btn.addClass("red");
                    
                }else if (status == "error"){
                    alert("系统错误，请联系管理员");
                }else if (status == "like_already"){
                    alert("已标记喜欢，请勿重复提交");
                }
            },'json');
        });
    });
</script>

</body>
</html>
